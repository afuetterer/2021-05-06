## Freie Universität Berlin | Universitätsbibliothek | Forschungsdatenmanagement
## Online-Workshopreihe zu Open Source Tools im FDM
# 06.05.2021 | Software-Abhängigkeiten richtig beschreiben: Einführung in das Dependency Management für datenbasierte Projekte mit Open Source Tools
---

# Technik-Check-in

Output der installierten Python Version.

```
$ python -V
Python 3.9.5

$ python3 -V
Python 3.9.5
```

Output der installierten pip Version.

```
$ pip -V
pip 21.0.1 from /home/afuetterer/.pyenv/versions/3.9.2/lib/python3.9/site-packages/pip (python 3.9)
```

Upgrade der installierten pip Version.

```
$ pip install --user --upgrade pip
```

Output der venv Hilfe.

```
$ python3 -m venv -h
```

Empfehlung für Windows-Nutzer*innen: [cmder](https://cmder.net/)


Download [Projektverzeichnis](https://box.fu-berlin.de/s/8DpTFdxbCMFf3ni/download)

---

# Demo und praktische Übungen

## Setup

- Download: [Projektverzeichnis](https://box.fu-berlin.de/s/8DpTFdxbCMFf3ni/download)
- Unzip
- CD in das Verzeichnis

---

## Szenario 01

Sie sind als wissenschaftlicher Mitarbeiter*in in einem Forschungsprojekt eingestellt worden. Die Forschenden möchten eine Datenbank mit Forschungsdaten aufbauen. U.a. sollen Daten von studentischen Hilfskräften aus Zeitschriftenartikeln und anderen Quellen zusammentragen und über eine Oberfläche eines Webportals in die Datenbank eingepflegt werden. Die Forschenden haben die Software von einem vergleichbaren Projekt übernommen. Da Sie sich unter den Beteiligten am besten mit Python-Programmierung auskennen, liegt die Anpassung und Weiterentwicklung des Webportals in Ihren Händen.

Eine Dokumentation des übernommenen Projekts liegt nicht vor. Die Verantwortlichen des Projekts haben Ihnen lediglich den Quellcode des Webportals zur Verfügung gestellt.

### Tasks

- Versuchen Sie einen Testserver zu starten. Navigieren Sie dazu in das Verzeichnis `01-demo/webportal` und führen Sie `python manage.py runserver` aus:

```
$ cd 01-testserver/webportal
$ python manage.py runserver
```

### Fragen

- Wie lautet das Ergebnis des Befehls?
- [Was bedeutet die Fehlermeldung?]
- [Wie können Sie die Fehlermeldung beheben?]

---

## Szenario 02

Sie haben entdeckt (durch Inspektion des Source codes oder durch Anfrage bei den Entwicklern), dass das Webportal-Projekt das Webframework `Django` einsetzt. Sie müssen also die Software Dependency Django installieren.

**Tipp:** Um die Softwareabhängigkeiten in verschiedenen Projekten (Projekt A benötigt Library X in Version 1.0, Projekt B benötigt Library X in Version 2.0) voneinander zu isolieren, gibt es in Python ein entsprechendes Tool: `virtualenv`.

### Tasks

- Erzeugen Sie eine virtuelle Umgebung (virtual environment) im Verzeichnis ENV_DIR (Konvention: `venv` oder `.venv`)

```
$ python -m venv ENV_DIR
# z.b.
$ python -m venv venv
# oder
$ python -m venv .venv
```

- Schauen Sie sich das erzeugte Verzeichnis an.
- Aktivieren Sie die virtuelle Umbebung:

```
# Linux
$ source venv/bin/activate
# Windows
$ venv\Scripts\activate.bat
```

- Was hat sich geändert?

- Installieren Sie `Django` mit `pip install`. `pip` ("Pip installs Packages") ist der Package Manager für Python, der u.a. Pakete vom [Python Package Index (PyPI)](https://pypi.org/) installieren kann.

```
(venv) $ pip install django
```

- Wie lautet die Ausgabe des Befehls? Was sagt Ihnen die Ausgabe?

- Versuchen Sie erneut den Testserver zu starten.

```
(venv) $ python manage.py runserver
```

### Fragen

- Wie lautet das Ergebnis des Befehls?
- [Was bedeutet die Fehlermeldung?]
- [Wie können Sie die Fehlermeldung beheben?]

### Referenzen
- [Virtual Environments and Packages](https://docs.python.org/3/tutorial/venv.html)
- [pip documentation v21.1](https://pip.pypa.io/en/stable/)
- [What Is Pip? A Guide for New Pythonistas | Real Python](https://realpython.com/what-is-pip/)
- [Python Virtual Environments: A Primer | Real Python](https://realpython.com/python-virtual-environments-a-primer/)

---

## Szenario 03

Sie lesen die Fehlermeldung, recherchieren bei Google und Stack Overflow, sowie durchsuchen den Sourcecode nach Hinweisen. U.a. werden Sie in `webportal/webportal/settings.py` fündig:
> Django settings for webportal project.
>
>Generated by 'django-admin startproject' using Django 1.8.

Laut der Ausgabe des `pip install django`-Befehls wurde die Version 3.2 installiert. Es scheint hier nicht abwärtskompatible Neuerungen zwischen den Versionen 3.2 und 1.8 zu geben. Sprich: Ihr Sourcecode läuft nicht unter Django-Version 3.2.

### Tasks

- Überprüfen Sie die installierten Versionen mit `pip list`:

```
(venv) $ pip list
Package    Version
---------- -------
asgiref    3.3.4
Django     3.2
pip        20.2.3
pytz       2021.1
setuptools 49.2.1
sqlparse   0.4.1
```

- Deinstallieren Sie `Django` mit `pip uninstall django`.

```
(venv) $ pip uninstall django
```

- Installieren Sie explizit Django in Version 1.8.

```
(venv) $ pip install django==1.8
```

- Versuchen Sie erneut den Testserver zu starten.

```
(venv) $ python manage.py runserver
```

Der Testserver sollte starten und auf [http://127.0.0.1:8000/](http://127.0.0.1:8000/) erreichbar sein. Sie können den Testserver mit STRG+C wieder beenden.

### Fragen

- Welche Message gibt der Testserver im Browser aus, wenn Sie [http://127.0.0.1:8000/](http://127.0.0.1:8000/) aufrufen?
- Was fällt Ihnen auf, wenn Sie erneut `pip list` ausführen?

---

## Szenario 04: > requirements.txt

Sie möchten sicherstellen, dass Sie und Ihre Kolleg*innen später nicht nocheinmal diese Recherche wiederholen müssen und die Softwareabhängigkeiten dokumentieren. Sie können das schriftlich in einem Dokument (z.B. README.md) tun. Das ist besser als keine Dokumentation, jedoch gibt es eine besser Lösung. Im Pythonumfeld hat sich die Benennung einer entsprechenden Datei, die nur die Softwareabhängigkeiten enthält als requirements.txt durchgesetzt. Die Abhängigkeiten können Sie ebenfalls mit `pip` dokumentieren.

### Tasks

- Vergleichen Sie den Output von `pip list` und `pip freeze`.

```
(venv) $ pip list
(venv) $ pip freeze
```

- Leiten Sie die Ausgabe von `pip freeze` in eine Textdatei um.

```
(venv) $ pip freeze > requirements.txt
```

- Prüfen Sie die Ausgabe von `pip list --outdated`.

---

## Szenario 05: -r requirements.txt

**Zeitsprung:** Sie haben mehrere Wochen an der Software des Webportals gearbeitet, neue Features implementiert und alles auf den neuesten Stand gebracht.

### Tasks

Deaktivieren Sie die virtuelle Umgebung und löschen Sie das Verzeichnis ENV_DIR (`venv` oder `.venv`). Navigieren Sie danach in das Verzeichnis `04/webportal`.

```
(venv) $ deactivate
$ rm -r venv/
$ cd 04/webportal
```

- Sehen Sie sich die Datei `requirements.txt` an. Was beinhaltet diese Datei?

Erstellen Sie eine neue/frische virtuelle Umgebung, aktivieren Sie diese und installieren Sie die Softwareabhängigkeiten aus der Datei `requirements.txt`.

```
(venv) $ pip install -r requirements.txt
```

- Starten Sie den Testserver erneut.

### Fragen

- Welche Message gibt der Testserver im Browser aus, wenn Sie [http://127.0.0.1:8000/](http://127.0.0.1:8000/) aufrufen?

---

## [Optional] Szenario 06: Development vs. Production

pytest

---

## [Optional] Szenario 07: Pipenv

```
$ pip install pipenv
$ pipenv -h
```

```
$ pipenv install --dev
```

```
$ pipenv shell
(webportal) $ pip list
```

```
(webportal) $ pipenv graph
```

```
(webportal) $ deactivate
```

---

## [Optional] Szenario 08: Poetry

```
$ pip install poetry
$ poetry -h
```

```
$ pip install poetry
```

```
$ poetry install
```

```
$ poetry show
```

```
$ poetry shell
(webportal-HDh-kelF-py3.9) $
```

```
(webportal-HDh-kelF-py3.9) $ deactivate
```



---
